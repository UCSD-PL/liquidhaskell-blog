---
layout: post
title: "Binary Search Trees"
date: 2013-02-15 16:12
comments: true
external-url:
categories: abstract-refinements
author: Niki Vazou
published: false
---

In this example, we show how we can use multi-parameter abstract refinements 
to encode ordering invarants on tree structures.


<pre><span class=hs-linenum>16: </span><span class='hs-keyword'>module</span> <span class='hs-conid'>Map</span> <span class='hs-keyword'>where</span>
</pre>

Take for example the following refined type used to encode functional maps (from Data.Map):


<pre><span class=hs-linenum>22: </span><span class='hs-keyword'>{-@</span> 
<span class=hs-linenum>23: </span>  <span class='hs-keyword'>data</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;</span><span class='hs-varid'>l</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>root</span><span class='hs-conop'>:</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Prop</span><span class='hs-layout'>,</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>root</span><span class='hs-conop'>:</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Prop</span><span class='hs-varop'>&gt;</span>
<span class=hs-linenum>24: </span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Tip</span> 
<span class=hs-linenum>25: </span>      <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Bin</span> <span class='hs-layout'>(</span><span class='hs-varid'>sz</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Size</span><span class='hs-layout'>)</span> 
<span class=hs-linenum>26: </span>            <span class='hs-layout'>(</span><span class='hs-varid'>key</span>   <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> 
<span class=hs-linenum>27: </span>            <span class='hs-layout'>(</span><span class='hs-varid'>value</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> 
<span class=hs-linenum>28: </span>            <span class='hs-layout'>(</span><span class='hs-varid'>left</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Map</span> <span class='hs-varop'>&lt;</span><span class='hs-varid'>l</span><span class='hs-layout'>,</span> <span class='hs-varid'>r</span><span class='hs-varop'>&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-varop'>&lt;</span><span class='hs-varid'>l</span> <span class='hs-varid'>key</span><span class='hs-varop'>&gt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> 
<span class=hs-linenum>29: </span>            <span class='hs-layout'>(</span><span class='hs-varid'>right</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Map</span> <span class='hs-varop'>&lt;</span><span class='hs-varid'>l</span><span class='hs-layout'>,</span> <span class='hs-varid'>r</span><span class='hs-varop'>&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-varop'>&lt;</span><span class='hs-varid'>r</span> <span class='hs-varid'>key</span><span class='hs-varop'>&gt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> 
<span class=hs-linenum>30: </span>  <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>31: </span>
<span class=hs-linenum>32: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Tip</span>
<span class=hs-linenum>33: </span>             <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Bin</span> <span class='hs-conid'>Size</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<span class=hs-linenum>34: </span>
<span class=hs-linenum>35: </span><span class='hs-keyword'>type</span> <span class='hs-conid'>Size</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Int</span>
</pre>

The abstract refinements `l` and `r` relate each `key` of the tree with `all` the keys in the `left` and `right` subtrees of `key`, as those keys are respectively of type `k <l key>` and `k <r key>`.

Thus, if we instantiate the refinements with the following predicates


<pre><span class=hs-linenum>43: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>BST</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span> <span class='hs-varop'>&lt;\</span><span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>v</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>r</span> <span class='hs-layout'>}</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>v</span> <span class='hs-varop'>&gt;</span> <span class='hs-varid'>r</span> <span class='hs-layout'>}</span><span class='hs-varop'>&gt;</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>44: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>MinHeap</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span> <span class='hs-varop'>&lt;\</span><span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>r</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>v</span><span class='hs-layout'>}</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>r</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>v</span><span class='hs-layout'>}</span><span class='hs-varop'>&gt;</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>45: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>MaxHeap</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span> <span class='hs-varop'>&lt;\</span><span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>r</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>v</span><span class='hs-layout'>}</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>r</span> <span class='hs-varop'>&gt;=</span> <span class='hs-varid'>v</span><span class='hs-layout'>}</span><span class='hs-varop'>&gt;</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>@-}</span>
</pre>

then `BST k v`, `MinHeap k v` and `MaxHeap k v` denote exactly binary-search-ordered, min-heap-ordered, and max-heap-ordered trees (with keys and values of types `k` and `v`).  

We can use the above types to automatically verify ordering properties of complex libraries.

For example, we cab use `BST` to prove that `Data.Map`'s `insert` and `delete` functions return a binary search tree:


<pre><span class=hs-linenum>55: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>insert</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>k</span><span class='hs-conop'>:</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-conop'>:</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>t</span><span class='hs-conop'>:</span><span class='hs-conid'>BST</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BST</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>56: </span><span class='hs-definition'>insert</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>57: </span><a class=annot href="#"><span class=annottext>forall a b. (Ord a) -&gt; a -&gt; b -&gt; (Map a b) -&gt; (Map a b)</span><span class='hs-definition'>insert</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>kx</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>(Map a b)</span><span class='hs-varid'>t</span></a>
<span class=hs-linenum>58: </span>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <a class=annot href="#"><span class=annottext>{VV : (Map a b) | (VV = t)}</span><span class='hs-varid'>t</span></a> <span class='hs-keyword'>of</span> 
<span class=hs-linenum>59: </span>     <span class='hs-conid'>Tip</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>k:{VV : a | (VV = kx)}
-&gt; x:{VV : b | (VV = x)}
-&gt; (Map {VV : a | (VV = k),(VV = kx)} {VV : b | (VV = x),(VV = x)})</span><span class='hs-varid'>singleton</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = kx)}</span><span class='hs-varid'>kx</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a>
<span class=hs-linenum>60: </span>     <span class='hs-conid'>Bin</span> <span class='hs-varid'>sz</span> <span class='hs-varid'>ky</span> <span class='hs-varid'>y</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span>
<span class=hs-linenum>61: </span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <a class=annot href="#"><span class=annottext>x:a
-&gt; y:a
-&gt; {VV : (Ordering) | ((VV = EQ) &lt;=&gt; (x = y)),
                      ((VV = GT) &lt;=&gt; (x &gt; y)),
                      ((VV = LT) &lt;=&gt; (x &lt; y))}</span><span class='hs-varid'>compare</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = kx)}</span><span class='hs-varid'>kx</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = ky)}</span><span class='hs-varid'>ky</span></a> <span class='hs-keyword'>of</span>
<span class=hs-linenum>62: </span>              <span class='hs-conid'>LT</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-varid'>balance</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = ky)}</span><span class='hs-varid'>ky</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = y)}</span><span class='hs-varid'>y</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV : a | (VV &lt; ky)}
-&gt; b
-&gt; (Map {VV : a | (VV &lt; ky)} b)
-&gt; (Map {VV : a | (VV &lt; ky)} b)</span><span class='hs-varid'>insert</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = kx)}</span><span class='hs-varid'>kx</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; ky)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; ky)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>63: </span>              <span class='hs-conid'>GT</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-varid'>balance</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = ky)}</span><span class='hs-varid'>ky</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = y)}</span><span class='hs-varid'>y</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; ky)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV : a | (VV &gt; ky)}
-&gt; b
-&gt; (Map {VV : a | (VV &gt; ky)} b)
-&gt; (Map {VV : a | (VV &gt; ky)} b)</span><span class='hs-varid'>insert</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = kx)}</span><span class='hs-varid'>kx</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; ky)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>64: </span>              <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>forall &lt;r :: a -&gt; a -&gt; Bool , l :: a -&gt; a -&gt; Bool&gt;.
(Int)
-&gt; key:a
-&gt; b
-&gt; (Map a&lt;l (root, EVar key) 1&gt; b)
-&gt; (Map a&lt;r (root, EVar key) 1&gt; b)
-&gt; (Map a b)</span><span class='hs-conid'>Bin</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = sz)}</span><span class='hs-varid'>sz</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = kx)}</span><span class='hs-varid'>kx</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; ky)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; ky)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>65: </span>
<span class=hs-linenum>66: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>delete</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>k</span><span class='hs-conop'>:</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>t</span><span class='hs-conop'>:</span><span class='hs-conid'>BST</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BST</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>67: </span><span class='hs-definition'>delete</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>68: </span><a class=annot href="#"><span class=annottext>forall a b. (Ord a) -&gt; a -&gt; (Map a b) -&gt; (Map a b)</span><span class='hs-definition'>delete</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>(Map a b)</span><span class='hs-varid'>t</span></a> 
<span class=hs-linenum>69: </span>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <a class=annot href="#"><span class=annottext>{VV : (Map a b) | (VV = t)}</span><span class='hs-varid'>t</span></a> <span class='hs-keyword'>of</span> 
<span class=hs-linenum>70: </span>      <span class='hs-conid'>Tip</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>forall &lt;r :: a -&gt; a -&gt; Bool , l :: a -&gt; a -&gt; Bool&gt;.
(Map {VV : a | false} {VV : b | false})</span><span class='hs-conid'>Tip</span></a>
<span class=hs-linenum>71: </span>      <span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>kx</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span>
<span class=hs-linenum>72: </span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <a class=annot href="#"><span class=annottext>x:a
-&gt; y:a
-&gt; {VV : (Ordering) | ((VV = EQ) &lt;=&gt; (x = y)),
                      ((VV = GT) &lt;=&gt; (x &gt; y)),
                      ((VV = LT) &lt;=&gt; (x &lt; y))}</span><span class='hs-varid'>compare</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = kx)}</span><span class='hs-varid'>kx</span></a> <span class='hs-keyword'>of</span> 
<span class=hs-linenum>73: </span>               <span class='hs-conid'>LT</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-varid'>balance</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = kx)}</span><span class='hs-varid'>kx</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV : a | (VV &lt; kx)}
-&gt; (Map {VV : a | (VV &lt; kx)} b) -&gt; (Map {VV : a | (VV &lt; kx)} b)</span><span class='hs-varid'>delete</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; kx)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; kx)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>74: </span>               <span class='hs-conid'>GT</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-varid'>balance</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = kx)}</span><span class='hs-varid'>kx</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; kx)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV : a | (VV &gt; kx)}
-&gt; (Map {VV : a | (VV &gt; kx)} b) -&gt; (Map {VV : a | (VV &gt; kx)} b)</span><span class='hs-varid'>delete</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; kx)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>75: </span>               <span class='hs-conid'>EQ</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>k:a
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map {VV : a | (VV != k)} b)</span><span class='hs-varid'>glue</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = kx)}</span><span class='hs-varid'>kx</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; kx)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; kx)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
</pre>


Below are the functions used by `insert` and `delete`:


<pre><span class=hs-linenum>82: </span><span class='hs-definition'>singleton</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>83: </span><a class=annot href="#"><span class=annottext>forall a b.
k:a -&gt; x:b -&gt; (Map {VV : a | (VV = k)} {VV : b | (VV = x)})</span><span class='hs-definition'>singleton</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x</span></a>
<span class=hs-linenum>84: </span>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>forall &lt;r :: a -&gt; a -&gt; Bool , l :: a -&gt; a -&gt; Bool&gt;.
(Int)
-&gt; key:{VV : a | (VV = k)}
-&gt; {VV : b | (VV = x)}
-&gt; (Map {VV : a&lt;l (root,
                   EVar key) 1&gt; | (VV = k)} {VV : b | (VV = x)})
-&gt; (Map {VV : a&lt;r (root,
                   EVar key) 1&gt; | (VV = k)} {VV : b | (VV = x)})
-&gt; (Map {VV : a | (VV = k)} {VV : b | (VV = x)})</span><span class='hs-conid'>Bin</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = (1  :  int))}</span><span class='hs-num'>1</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | false} {VV : b | false})</span><span class='hs-conid'>Tip</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | false} {VV : b | false})</span><span class='hs-conid'>Tip</span></a>
<span class=hs-linenum>85: </span>
<span class=hs-linenum>86: </span>
<span class=hs-linenum>87: </span><span class='hs-definition'>glue</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>88: </span><a class=annot href="#"><span class=annottext>forall a b.
k:a
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map {VV : a | (VV != k)} b)</span><span class='hs-definition'>glue</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>k</span></a> <span class='hs-conid'>Tip</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; k)} b)</span><span class='hs-varid'>r</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>89: </span><span class='hs-definition'>glue</span> <span class='hs-varid'>k</span> <span class='hs-varid'>l</span> <span class='hs-conid'>Tip</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = ds_d1qq)}</span><span class='hs-varid'>l</span></a>
<span class=hs-linenum>90: </span><span class='hs-definition'>glue</span> <span class='hs-varid'>k</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span>
<span class=hs-linenum>91: </span>  <span class='hs-keyglyph'>|</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &lt; k)} b) -&gt; (Int)</span><span class='hs-varid'>size</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = ds_d1qq)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>x:(Int) -&gt; y:(Int) -&gt; {VV : (Bool) | ((? Prop([VV])) &lt;=&gt; (x &gt; y))}</span><span class='hs-varop'>&gt;</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; k)} b) -&gt; (Int)</span><span class='hs-varid'>size</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV : a | (VV = km1),(VV &lt; k)}</span><span class='hs-varid'>km1</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : a | (VV = vm)}</span><span class='hs-varid'>vm</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k),
                     (VV &lt; km1),
                     (VV &lt; km1)} b) | (VV = lm)}</span><span class='hs-varid'>lm</span></a><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &lt; k)} b)
-&gt; ({VV : a | (VV &lt; k)} , b , (Map {VV : a | (VV &lt; k)} b))</span><span class='hs-varid'>deleteFindMax</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = ds_d1qq)}</span><span class='hs-varid'>l</span></a> <span class='hs-keyword'>in</span> <a class=annot href="#"><span class=annottext>k:{VV : a | (VV != k)}
-&gt; b
-&gt; (Map {VV : a | (VV != k),(VV &lt; k)} b)
-&gt; (Map {VV : a | (VV != k),(VV &gt; k)} b)
-&gt; (Map {VV : a | (VV != k)} b)</span><span class='hs-varid'>balance</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = km1),(VV = km1),(VV &lt; k)}</span><span class='hs-varid'>km1</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = vm),(VV = vm)}</span><span class='hs-varid'>vm</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k),
                     (VV &lt; km1),
                     (VV &lt; km1)} b) | (VV = lm),(VV = lm)}</span><span class='hs-varid'>lm</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>92: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>       <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV : a | (VV = km2),(VV &gt; k)}</span><span class='hs-varid'>km2</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : a | (VV = vm)}</span><span class='hs-varid'>vm</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k),
                     (VV &gt; km2),
                     (VV &gt; km2)} b) | (VV = rm)}</span><span class='hs-varid'>rm</span></a><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; k)} b)
-&gt; ({VV : a | (VV &gt; k)} , b , (Map {VV : a | (VV &gt; k)} b))</span><span class='hs-varid'>deleteFindMin</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a> <span class='hs-keyword'>in</span> <a class=annot href="#"><span class=annottext>k:{VV : a | (VV != k)}
-&gt; b
-&gt; (Map {VV : a | (VV != k),(VV &lt; k)} b)
-&gt; (Map {VV : a | (VV != k),(VV &gt; k)} b)
-&gt; (Map {VV : a | (VV != k)} b)</span><span class='hs-varid'>balance</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = km2),(VV = km2),(VV &gt; k)}</span><span class='hs-varid'>km2</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = vm),(VV = vm)}</span><span class='hs-varid'>vm</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = ds_d1qq)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k),
                     (VV &gt; km2),
                     (VV &gt; km2)} b) | (VV = rm),(VV = rm)}</span><span class='hs-varid'>rm</span></a>
<span class=hs-linenum>93: </span>
<span class=hs-linenum>94: </span><a class=annot href="#"><span class=annottext>(Map a b) -&gt; (a , b , (Map a b))</span><span class='hs-definition'>deleteFindMax</span></a> <a class=annot href="#"><span class=annottext>(Map a b)</span><span class='hs-varid'>t</span></a> 
<span class=hs-linenum>95: </span>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <a class=annot href="#"><span class=annottext>{VV : (Map a b) | (VV = t)}</span><span class='hs-varid'>t</span></a> <span class='hs-keyword'>of</span>
<span class=hs-linenum>96: </span>      <span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>k</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l</span> <span class='hs-conid'>Tip</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>forall a b c &lt;p3 :: b -&gt; a -&gt; c -&gt; Bool , p2 :: a -&gt; b -&gt; Bool&gt;.
x1:a
-&gt; x2:b&lt;p2 (fld, EVar x1) 1&gt;
-&gt; c&lt;p3 (fld1, EVar x2) (fld, EVar x1) 2&gt;
-&gt; (a , b , c)</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>97: </span>      <span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>k</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV : a | (VV = km3),(VV &gt; k)}</span><span class='hs-varid'>km3</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : a | (VV = vm)}</span><span class='hs-varid'>vm</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k),
                     (VV &lt; km3),
                     (VV &lt; km3)} b) | (VV = rm)}</span><span class='hs-varid'>rm</span></a><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>(Map a b) -&gt; (a , b , (Map a b))</span><span class='hs-varid'>deleteFindMax</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = ds_d1q2)}</span><span class='hs-varid'>r</span></a> <span class='hs-keyword'>in</span> 
<span class=hs-linenum>98: </span>                       <a class=annot href="#"><span class=annottext>forall a b c &lt;p3 :: b -&gt; a -&gt; c -&gt; Bool , p2 :: a -&gt; b -&gt; Bool&gt;.
x1:a
-&gt; x2:b&lt;p2 (fld, EVar x1) 1&gt;
-&gt; c&lt;p3 (fld1, EVar x2) (fld, EVar x1) 2&gt;
-&gt; (a , b , c)</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{VV : a | (VV = km3),(VV = km3),(VV &gt; k)}</span><span class='hs-varid'>km3</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : a | (VV = vm),(VV = vm)}</span><span class='hs-varid'>vm</span></a><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>k:{VV : a | (VV &lt; km3),(VV &lt; km3)}
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k),(VV &lt; km3),(VV &lt; km3)} b)
-&gt; (Map {VV : a | (VV &gt; k),(VV &lt; km3),(VV &lt; km3)} b)
-&gt; (Map {VV : a | (VV &lt; km3),(VV &lt; km3)} b)</span><span class='hs-varid'>balance</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k),
                     (VV &lt; km3),
                     (VV &lt; km3)} b) | (VV = rm),(VV = rm)}</span><span class='hs-varid'>rm</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>99: </span>      <span class='hs-conid'>Tip</span>           <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>forall a b c &lt;p3 :: b -&gt; a -&gt; c -&gt; Bool , p2 :: a -&gt; b -&gt; Bool&gt;.
x1:a
-&gt; x2:b&lt;p2 (fld, EVar x1) 1&gt;
-&gt; c&lt;p3 (fld1, EVar x2) (fld, EVar x1) 2&gt;
-&gt; (a , b , c)</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>[(Char)] -&gt; {VV : a | false}</span><span class='hs-varid'>error</span></a> <a class=annot href="#"><span class=annottext>{VV : [(Char)] | (VV = ms),(len([VV]) &gt;= 0)}</span><span class='hs-varid'>ms</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>[(Char)] -&gt; {VV : a | false}</span><span class='hs-varid'>error</span></a> <a class=annot href="#"><span class=annottext>{VV : [(Char)] | (VV = ms),(len([VV]) &gt;= 0)}</span><span class='hs-varid'>ms</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | false} {VV : b | false})</span><span class='hs-conid'>Tip</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>100: </span>  <span class='hs-keyword'>where</span> <a class=annot href="#"><span class=annottext>[(Char)]</span><span class='hs-varid'>ms</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>[(Char)]</span><span class='hs-str'>"Map.deleteFindMax : can not return the maximal element of an empty Map"</span></a>   
<span class=hs-linenum>101: </span>
<span class=hs-linenum>102: </span>
<span class=hs-linenum>103: </span><a class=annot href="#"><span class=annottext>(Map a b) -&gt; (a , b , (Map a b))</span><span class='hs-definition'>deleteFindMin</span></a> <a class=annot href="#"><span class=annottext>(Map a b)</span><span class='hs-varid'>t</span></a> 
<span class=hs-linenum>104: </span>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <a class=annot href="#"><span class=annottext>{VV : (Map a b) | (VV = t)}</span><span class='hs-varid'>t</span></a> <span class='hs-keyword'>of</span>
<span class=hs-linenum>105: </span>      <span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>k</span> <span class='hs-varid'>x</span> <span class='hs-conid'>Tip</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>forall a b c &lt;p3 :: b -&gt; a -&gt; c -&gt; Bool , p2 :: a -&gt; b -&gt; Bool&gt;.
x1:a
-&gt; x2:b&lt;p2 (fld, EVar x1) 1&gt;
-&gt; c&lt;p3 (fld1, EVar x2) (fld, EVar x1) 2&gt;
-&gt; (a , b , c)</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>106: </span>      <span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>k</span> <span class='hs-varid'>x</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV : a | (VV = km4),(VV &lt; k)}</span><span class='hs-varid'>km4</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : a | (VV = vm)}</span><span class='hs-varid'>vm</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; km4),
                     (VV &gt; km4),
                     (VV &lt; k)} b) | (VV = lm)}</span><span class='hs-varid'>lm</span></a><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>(Map a b) -&gt; (a , b , (Map a b))</span><span class='hs-varid'>deleteFindMin</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = ds_d1pL)}</span><span class='hs-varid'>l</span></a> <span class='hs-keyword'>in</span> 
<span class=hs-linenum>107: </span>                       <a class=annot href="#"><span class=annottext>forall a b c &lt;p3 :: b -&gt; a -&gt; c -&gt; Bool , p2 :: a -&gt; b -&gt; Bool&gt;.
x1:a
-&gt; x2:b&lt;p2 (fld, EVar x1) 1&gt;
-&gt; c&lt;p3 (fld1, EVar x2) (fld, EVar x1) 2&gt;
-&gt; (a , b , c)</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{VV : a | (VV = km4),(VV = km4),(VV &lt; k)}</span><span class='hs-varid'>km4</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : a | (VV = vm),(VV = vm)}</span><span class='hs-varid'>vm</span></a><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>k:{VV : a | (VV &gt; km4),(VV &gt; km4)}
-&gt; b
-&gt; (Map {VV : a | (VV &gt; km4),(VV &gt; km4),(VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k),(VV &gt; km4),(VV &gt; km4)} b)
-&gt; (Map {VV : a | (VV &gt; km4),(VV &gt; km4)} b)</span><span class='hs-varid'>balance</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; km4),
                     (VV &gt; km4),
                     (VV &lt; k)} b) | (VV = lm),(VV = lm)}</span><span class='hs-varid'>lm</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>108: </span>      <span class='hs-conid'>Tip</span>             <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>forall a b c &lt;p3 :: b -&gt; a -&gt; c -&gt; Bool , p2 :: a -&gt; b -&gt; Bool&gt;.
x1:a
-&gt; x2:b&lt;p2 (fld, EVar x1) 1&gt;
-&gt; c&lt;p3 (fld1, EVar x2) (fld, EVar x1) 2&gt;
-&gt; (a , b , c)</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>[(Char)] -&gt; {VV : a | false}</span><span class='hs-varid'>error</span></a> <a class=annot href="#"><span class=annottext>{VV : [(Char)] | (VV = ms),(len([VV]) &gt;= 0)}</span><span class='hs-varid'>ms</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>[(Char)] -&gt; {VV : a | false}</span><span class='hs-varid'>error</span></a> <a class=annot href="#"><span class=annottext>{VV : [(Char)] | (VV = ms),(len([VV]) &gt;= 0)}</span><span class='hs-varid'>ms</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | false} {VV : b | false})</span><span class='hs-conid'>Tip</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>109: </span>  <span class='hs-keyword'>where</span> <a class=annot href="#"><span class=annottext>[(Char)]</span><span class='hs-varid'>ms</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>[(Char)]</span><span class='hs-str'>"Map.deleteFindMin : can not return the maximal element of an empty Map"</span></a>   
<span class=hs-linenum>110: </span>
<span class=hs-linenum>111: </span>
<span class=hs-linenum>112: </span><span class='hs-comment'>-------------------------------------------------------------------------------</span>
<span class=hs-linenum>113: </span><span class='hs-comment'>--------------------------------- BALANCE -------------------------------------</span>
<span class=hs-linenum>114: </span><span class='hs-comment'>-------------------------------------------------------------------------------</span>
<span class=hs-linenum>115: </span>
<span class=hs-linenum>116: </span><span class='hs-definition'>delta</span><span class='hs-layout'>,</span> <span class='hs-varid'>ratio</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>117: </span><a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = (5  :  int))}</span><span class='hs-definition'>delta</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = (5  :  int))}</span><span class='hs-num'>5</span></a>
<span class=hs-linenum>118: </span><a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = (2  :  int))}</span><span class='hs-definition'>ratio</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = (2  :  int))}</span><span class='hs-num'>2</span></a>
<span class=hs-linenum>119: </span>
<span class=hs-linenum>120: </span><span class='hs-definition'>balance</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> 
<span class=hs-linenum>121: </span><a class=annot href="#"><span class=annottext>forall a b.
k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-definition'>balance</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &lt; k)} b)</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; k)} b)</span><span class='hs-varid'>r</span></a> 
<span class=hs-linenum>122: </span>  <span class='hs-keyglyph'>|</span> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = sizeL)}</span><span class='hs-varid'>sizeL</span></a> <a class=annot href="#"><span class=annottext>x:(Int) -&gt; y:(Int) -&gt; {VV : (Int) | (VV = (x + y))}</span><span class='hs-varop'>+</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = sizeR)}</span><span class='hs-varid'>sizeR</span></a> <a class=annot href="#"><span class=annottext>x:(Int) -&gt; y:(Int) -&gt; {VV : (Bool) | ((? Prop([VV])) &lt;=&gt; (x &lt;= y))}</span><span class='hs-varop'>&lt;=</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = (1  :  int))}</span><span class='hs-num'>1</span></a>   <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>forall &lt;r :: a -&gt; a -&gt; Bool , l :: a -&gt; a -&gt; Bool&gt;.
(Int)
-&gt; key:a
-&gt; b
-&gt; (Map a&lt;l (root, EVar key) 1&gt; b)
-&gt; (Map a&lt;r (root, EVar key) 1&gt; b)
-&gt; (Map a b)</span><span class='hs-conid'>Bin</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = sizeX)}</span><span class='hs-varid'>sizeX</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>123: </span>  <span class='hs-keyglyph'>|</span> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = sizeR)}</span><span class='hs-varid'>sizeR</span></a> <a class=annot href="#"><span class=annottext>x:(Int) -&gt; y:(Int) -&gt; {VV : (Bool) | ((? Prop([VV])) &lt;=&gt; (x &gt;= y))}</span><span class='hs-varop'>&gt;=</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = delta),(VV = (5  :  int))}</span><span class='hs-varid'>delta</span></a><a class=annot href="#"><span class=annottext>x:(Int)
-&gt; y:(Int) -&gt; {VV : (Int) | (&amp;&amp; [(x &gt;= 0); (y &gt;= 0)] =&gt; (VV &gt;= 0))}</span><span class='hs-varop'>*</span></a><a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = sizeL)}</span><span class='hs-varid'>sizeL</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-varid'>rotateL</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>124: </span>  <span class='hs-keyglyph'>|</span> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = sizeL)}</span><span class='hs-varid'>sizeL</span></a> <a class=annot href="#"><span class=annottext>x:(Int) -&gt; y:(Int) -&gt; {VV : (Bool) | ((? Prop([VV])) &lt;=&gt; (x &gt;= y))}</span><span class='hs-varop'>&gt;=</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = delta),(VV = (5  :  int))}</span><span class='hs-varid'>delta</span></a><a class=annot href="#"><span class=annottext>x:(Int)
-&gt; y:(Int) -&gt; {VV : (Int) | (&amp;&amp; [(x &gt;= 0); (y &gt;= 0)] =&gt; (VV &gt;= 0))}</span><span class='hs-varop'>*</span></a><a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = sizeR)}</span><span class='hs-varid'>sizeR</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-varid'>rotateR</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>125: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>            <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>forall &lt;r :: a -&gt; a -&gt; Bool , l :: a -&gt; a -&gt; Bool&gt;.
(Int)
-&gt; key:a
-&gt; b
-&gt; (Map a&lt;l (root, EVar key) 1&gt; b)
-&gt; (Map a&lt;r (root, EVar key) 1&gt; b)
-&gt; (Map a b)</span><span class='hs-conid'>Bin</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = sizeX)}</span><span class='hs-varid'>sizeX</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>126: </span>  <span class='hs-keyword'>where</span> <a class=annot href="#"><span class=annottext>(Int)</span><span class='hs-varid'>sizeL</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &lt; k)} b) -&gt; (Int)</span><span class='hs-varid'>size</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a>
<span class=hs-linenum>127: </span>        <a class=annot href="#"><span class=annottext>(Int)</span><span class='hs-varid'>sizeR</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; k)} b) -&gt; (Int)</span><span class='hs-varid'>size</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>128: </span>        <a class=annot href="#"><span class=annottext>(Int)</span><span class='hs-varid'>sizeX</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = sizeL)}</span><span class='hs-varid'>sizeL</span></a> <a class=annot href="#"><span class=annottext>x:(Int) -&gt; y:(Int) -&gt; {VV : (Int) | (VV = (x + y))}</span><span class='hs-varop'>+</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = sizeR)}</span><span class='hs-varid'>sizeR</span></a> <a class=annot href="#"><span class=annottext>x:(Int) -&gt; y:(Int) -&gt; {VV : (Int) | (VV = (x + y))}</span><span class='hs-varop'>+</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = (1  :  int))}</span><span class='hs-num'>1</span></a>
<span class=hs-linenum>129: </span>
<span class=hs-linenum>130: </span><span class='hs-comment'>-- rotate</span>
<span class=hs-linenum>131: </span><span class='hs-definition'>rotateL</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<span class=hs-linenum>132: </span><a class=annot href="#"><span class=annottext>forall a b.
k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-definition'>rotateL</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &lt; k)} b)</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; k)} b)</span><span class='hs-varid'>r</span></a><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ly</span> <span class='hs-varid'>ry</span><span class='hs-layout'>)</span> 
<span class=hs-linenum>133: </span>  <span class='hs-keyglyph'>|</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; k),(VV &lt; ds_d1pd)} b) -&gt; (Int)</span><span class='hs-varid'>size</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k),(VV &lt; ds_d1pd)} b) | (VV = ly)}</span><span class='hs-varid'>ly</span></a> <a class=annot href="#"><span class=annottext>x:(Int) -&gt; y:(Int) -&gt; {VV : (Bool) | ((? Prop([VV])) &lt;=&gt; (x &lt; y))}</span><span class='hs-varop'>&lt;</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = ratio),(VV = (2  :  int))}</span><span class='hs-varid'>ratio</span></a><a class=annot href="#"><span class=annottext>x:(Int)
-&gt; y:(Int) -&gt; {VV : (Int) | (&amp;&amp; [(x &gt;= 0); (y &gt;= 0)] =&gt; (VV &gt;= 0))}</span><span class='hs-varop'>*</span></a><a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; ds_d1pd),(VV &gt; k)} b) -&gt; (Int)</span><span class='hs-varid'>size</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; ds_d1pd),(VV &gt; k)} b) | (VV = ry)}</span><span class='hs-varid'>ry</span></a>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>k1:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k1)} b)
-&gt; (Map {VV : a | (VV &gt; k1)} b)
-&gt; (Map a b)</span><span class='hs-varid'>singleL</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r),
                                    (VV = Bin([ds_d1pc; ds_d1pd; ds_d1pe; ly; ry]))}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>134: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>k1:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k1)} b)
-&gt; (Map {VV : a | (VV &gt; k1)} b)
-&gt; (Map a b)</span><span class='hs-varid'>doubleL</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r),
                                    (VV = Bin([ds_d1pc; ds_d1pd; ds_d1pe; ly; ry]))}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>135: </span><span class='hs-definition'>rotateL</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>Tip</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>[(Char)] -&gt; {VV : (Map {VV : a | false} {VV : b | false}) | false}</span><span class='hs-varid'>error</span></a> <a class=annot href="#"><span class=annottext>{VV : [(Char)] | (len([VV]) &gt;= 0)}</span><span class='hs-str'>"rotateL Tip"</span></a>
<span class=hs-linenum>136: </span>
<span class=hs-linenum>137: </span><span class='hs-definition'>rotateR</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<span class=hs-linenum>138: </span><a class=annot href="#"><span class=annottext>forall a b.
k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-definition'>rotateR</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &lt; k)} b)</span><span class='hs-varid'>l</span></a><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ly</span> <span class='hs-varid'>ry</span><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; k)} b)</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>139: </span>  <span class='hs-keyglyph'>|</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; ds_d1pk),(VV &lt; k)} b) -&gt; (Int)</span><span class='hs-varid'>size</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; ds_d1pk),(VV &lt; k)} b) | (VV = ry)}</span><span class='hs-varid'>ry</span></a> <a class=annot href="#"><span class=annottext>x:(Int) -&gt; y:(Int) -&gt; {VV : (Bool) | ((? Prop([VV])) &lt;=&gt; (x &lt; y))}</span><span class='hs-varop'>&lt;</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = ratio),(VV = (2  :  int))}</span><span class='hs-varid'>ratio</span></a><a class=annot href="#"><span class=annottext>x:(Int)
-&gt; y:(Int) -&gt; {VV : (Int) | (&amp;&amp; [(x &gt;= 0); (y &gt;= 0)] =&gt; (VV &gt;= 0))}</span><span class='hs-varop'>*</span></a><a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &lt; ds_d1pk),(VV &lt; k)} b) -&gt; (Int)</span><span class='hs-varid'>size</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; ds_d1pk),(VV &lt; k)} b) | (VV = ly)}</span><span class='hs-varid'>ly</span></a>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>k1:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k1)} b)
-&gt; (Map {VV : a | (VV &gt; k1)} b)
-&gt; (Map a b)</span><span class='hs-varid'>singleR</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l),
                                    (VV = Bin([ds_d1pj; ds_d1pk; ds_d1pl; ly; ry]))}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>140: </span>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>k1:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k1)} b)
-&gt; (Map {VV : a | (VV &gt; k1)} b)
-&gt; (Map a b)</span><span class='hs-varid'>doubleR</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l),
                                    (VV = Bin([ds_d1pj; ds_d1pk; ds_d1pl; ly; ry]))}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>141: </span><span class='hs-definition'>rotateR</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>Tip</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>[(Char)] -&gt; {VV : (Map {VV : a | false} {VV : b | false}) | false}</span><span class='hs-varid'>error</span></a> <a class=annot href="#"><span class=annottext>{VV : [(Char)] | (len([VV]) &gt;= 0)}</span><span class='hs-str'>"rotateR Tip"</span></a>
<span class=hs-linenum>142: </span>
<span class=hs-linenum>143: </span><span class='hs-comment'>-- basic rotations</span>
<span class=hs-linenum>144: </span><span class='hs-definition'>singleL</span><span class='hs-layout'>,</span> <span class='hs-varid'>singleR</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<span class=hs-linenum>145: </span><a class=annot href="#"><span class=annottext>forall a b.
k1:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k1)} b)
-&gt; (Map {VV : a | (VV &gt; k1)} b)
-&gt; (Map a b)</span><span class='hs-definition'>singleL</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>k1</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x1</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &lt; k1)} b)</span><span class='hs-varid'>t1</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>k2</span> <span class='hs-varid'>x2</span> <span class='hs-varid'>t2</span> <span class='hs-varid'>t3</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-varid'>bin</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k2),(VV &gt; k1)}</span><span class='hs-varid'>k2</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x2)}</span><span class='hs-varid'>x2</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>k:{VV : a | (VV &lt; k2)}
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k),(VV &lt; k2)} b)
-&gt; (Map {VV : a | (VV &gt; k),(VV &lt; k2)} b)
-&gt; (Map {VV : a | (VV &lt; k2)} b)</span><span class='hs-varid'>bin</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k1)}</span><span class='hs-varid'>k1</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x1)}</span><span class='hs-varid'>x1</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k1)} b) | (VV = t1)}</span><span class='hs-varid'>t1</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k1),(VV &lt; k2)} b) | (VV = t2)}</span><span class='hs-varid'>t2</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k1),(VV &gt; k2)} b) | (VV = t3)}</span><span class='hs-varid'>t3</span></a>
<span class=hs-linenum>146: </span><span class='hs-definition'>singleL</span> <span class='hs-keyword'>_</span>  <span class='hs-keyword'>_</span>  <span class='hs-keyword'>_</span> <span class='hs-conid'>Tip</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>[(Char)] -&gt; {VV : (Map {VV : a | false} {VV : b | false}) | false}</span><span class='hs-varid'>error</span></a> <a class=annot href="#"><span class=annottext>{VV : [(Char)] | (len([VV]) &gt;= 0)}</span><span class='hs-str'>"sinlgeL Tip"</span></a>
<span class=hs-linenum>147: </span><a class=annot href="#"><span class=annottext>forall a b.
k1:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k1)} b)
-&gt; (Map {VV : a | (VV &gt; k1)} b)
-&gt; (Map a b)</span><span class='hs-definition'>singleR</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>k1</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x1</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>k2</span> <span class='hs-varid'>x2</span> <span class='hs-varid'>t1</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; k1)} b)</span><span class='hs-varid'>t3</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>forall &lt;r :: a -&gt; a -&gt; Bool , l :: a -&gt; a -&gt; Bool&gt;.
(Int)
-&gt; key:a
-&gt; b
-&gt; (Map a&lt;l (root, EVar key) 1&gt; b)
-&gt; (Map a&lt;r (root, EVar key) 1&gt; b)
-&gt; (Map a b)</span><span class='hs-conid'>Bin</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = (0  :  int))}</span><span class='hs-num'>0</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k2),(VV &lt; k1)}</span><span class='hs-varid'>k2</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x2)}</span><span class='hs-varid'>x2</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k1),(VV &lt; k2)} b) | (VV = t1)}</span><span class='hs-varid'>t1</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>forall &lt;r :: a -&gt; a -&gt; Bool , l :: a -&gt; a -&gt; Bool&gt;.
(Int)
-&gt; key:{VV : a | (VV &gt; k2)}
-&gt; b
-&gt; (Map {VV : a&lt;l (root, EVar key) 1&gt; | (VV &gt; k2)} b)
-&gt; (Map {VV : a&lt;r (root, EVar key) 1&gt; | (VV &gt; k2)} b)
-&gt; (Map {VV : a | (VV &gt; k2)} b)</span><span class='hs-conid'>Bin</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = (0  :  int))}</span><span class='hs-num'>0</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k1)}</span><span class='hs-varid'>k1</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x1)}</span><span class='hs-varid'>x1</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k2),(VV &lt; k1)} b) | (VV = t2)}</span><span class='hs-varid'>t2</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k1)} b) | (VV = t3)}</span><span class='hs-varid'>t3</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>148: </span><span class='hs-definition'>singleR</span> <span class='hs-keyword'>_</span>  <span class='hs-keyword'>_</span>  <span class='hs-keyword'>_</span> <span class='hs-conid'>Tip</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>[(Char)] -&gt; {VV : (Map {VV : a | false} {VV : b | false}) | false}</span><span class='hs-varid'>error</span></a> <a class=annot href="#"><span class=annottext>{VV : [(Char)] | (len([VV]) &gt;= 0)}</span><span class='hs-str'>"sinlgeR Tip"</span></a>
<span class=hs-linenum>149: </span>
<span class=hs-linenum>150: </span><span class='hs-definition'>doubleL</span><span class='hs-layout'>,</span> <span class='hs-varid'>doubleR</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<span class=hs-linenum>151: </span><a class=annot href="#"><span class=annottext>forall a b.
k1:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k1)} b)
-&gt; (Map {VV : a | (VV &gt; k1)} b)
-&gt; (Map a b)</span><span class='hs-definition'>doubleL</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>k1</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x1</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &lt; k1)} b)</span><span class='hs-varid'>t1</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>k2</span> <span class='hs-varid'>x2</span> <span class='hs-layout'>(</span><span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>k3</span> <span class='hs-varid'>x3</span> <span class='hs-varid'>t2</span> <span class='hs-varid'>t3</span><span class='hs-layout'>)</span> <span class='hs-varid'>t4</span><span class='hs-layout'>)</span>
<span class=hs-linenum>152: </span> <span class='hs-keyglyph'>=</span><a class=annot href="#"><span class=annottext>k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-varid'>bin</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k3),(VV &gt; k1),(VV &lt; k2)}</span><span class='hs-varid'>k3</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x3)}</span><span class='hs-varid'>x3</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>k:{VV : a | (VV &lt; k2),(VV &lt; k3)}
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k),(VV &lt; k2),(VV &lt; k3)} b)
-&gt; (Map {VV : a | (VV &gt; k),(VV &lt; k2),(VV &lt; k3)} b)
-&gt; (Map {VV : a | (VV &lt; k2),(VV &lt; k3)} b)</span><span class='hs-varid'>bin</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k1)}</span><span class='hs-varid'>k1</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x1)}</span><span class='hs-varid'>x1</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k1)} b) | (VV = t1)}</span><span class='hs-varid'>t1</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k1),(VV &lt; k2),(VV &lt; k3)} b) | (VV = t2)}</span><span class='hs-varid'>t2</span></a><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>k:{VV : a | (VV &gt; k1),(VV &gt; k3)}
-&gt; b
-&gt; (Map {VV : a | (VV &gt; k1),(VV &gt; k3),(VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k),(VV &gt; k1),(VV &gt; k3)} b)
-&gt; (Map {VV : a | (VV &gt; k1),(VV &gt; k3)} b)</span><span class='hs-varid'>bin</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k2),(VV &gt; k1)}</span><span class='hs-varid'>k2</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x2)}</span><span class='hs-varid'>x2</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k1),(VV &gt; k3),(VV &lt; k2)} b) | (VV = t3)}</span><span class='hs-varid'>t3</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k1),(VV &gt; k2)} b) | (VV = t4)}</span><span class='hs-varid'>t4</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>153: </span><span class='hs-definition'>doubleL</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>[(Char)] -&gt; {VV : (Map {VV : a | false} {VV : b | false}) | false}</span><span class='hs-varid'>error</span></a> <a class=annot href="#"><span class=annottext>{VV : [(Char)] | (len([VV]) &gt;= 0)}</span><span class='hs-str'>"doubleL"</span></a> 
<span class=hs-linenum>154: </span><a class=annot href="#"><span class=annottext>forall a b.
k1:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k1)} b)
-&gt; (Map {VV : a | (VV &gt; k1)} b)
-&gt; (Map a b)</span><span class='hs-definition'>doubleR</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>k1</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x1</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>k2</span> <span class='hs-varid'>x2</span> <span class='hs-varid'>t1</span> <span class='hs-layout'>(</span><span class='hs-conid'>Bin</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>k3</span> <span class='hs-varid'>x3</span> <span class='hs-varid'>t2</span> <span class='hs-varid'>t3</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; k1)} b)</span><span class='hs-varid'>t4</span></a> 
<span class=hs-linenum>155: </span>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-varid'>bin</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k3),(VV &gt; k2),(VV &lt; k1)}</span><span class='hs-varid'>k3</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x3)}</span><span class='hs-varid'>x3</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>k:{VV : a | (VV &lt; k1),(VV &lt; k3)}
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k),(VV &lt; k1),(VV &lt; k3)} b)
-&gt; (Map {VV : a | (VV &gt; k),(VV &lt; k1),(VV &lt; k3)} b)
-&gt; (Map {VV : a | (VV &lt; k1),(VV &lt; k3)} b)</span><span class='hs-varid'>bin</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k2),(VV &lt; k1)}</span><span class='hs-varid'>k2</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x2)}</span><span class='hs-varid'>x2</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k1),(VV &lt; k2)} b) | (VV = t1)}</span><span class='hs-varid'>t1</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k2),(VV &lt; k1),(VV &lt; k3)} b) | (VV = t2)}</span><span class='hs-varid'>t2</span></a><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>k:{VV : a | (VV &gt; k2),(VV &gt; k3)}
-&gt; b
-&gt; (Map {VV : a | (VV &gt; k2),(VV &gt; k3),(VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k),(VV &gt; k2),(VV &gt; k3)} b)
-&gt; (Map {VV : a | (VV &gt; k2),(VV &gt; k3)} b)</span><span class='hs-varid'>bin</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k1)}</span><span class='hs-varid'>k1</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x1)}</span><span class='hs-varid'>x1</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k2),(VV &gt; k3),(VV &lt; k1)} b) | (VV = t3)}</span><span class='hs-varid'>t3</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k1)} b) | (VV = t4)}</span><span class='hs-varid'>t4</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>156: </span><span class='hs-definition'>doubleR</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>[(Char)] -&gt; {VV : (Map {VV : a | false} {VV : b | false}) | false}</span><span class='hs-varid'>error</span></a> <a class=annot href="#"><span class=annottext>{VV : [(Char)] | (len([VV]) &gt;= 0)}</span><span class='hs-str'>"doubleR"</span></a> 
<span class=hs-linenum>157: </span>
<span class=hs-linenum>158: </span><span class='hs-definition'>bin</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>159: </span><a class=annot href="#"><span class=annottext>forall a b.
k:a
-&gt; b
-&gt; (Map {VV : a | (VV &lt; k)} b)
-&gt; (Map {VV : a | (VV &gt; k)} b)
-&gt; (Map a b)</span><span class='hs-definition'>bin</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &lt; k)} b)</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; k)} b)</span><span class='hs-varid'>r</span></a> 
<span class=hs-linenum>160: </span>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>forall &lt;r :: a -&gt; a -&gt; Bool , l :: a -&gt; a -&gt; Bool&gt;.
(Int)
-&gt; key:a
-&gt; b
-&gt; (Map a&lt;l (root, EVar key) 1&gt; b)
-&gt; (Map a&lt;r (root, EVar key) 1&gt; b)
-&gt; (Map a b)</span><span class='hs-conid'>Bin</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &lt; k)} b) -&gt; (Int)</span><span class='hs-varid'>size</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>x:(Int) -&gt; y:(Int) -&gt; {VV : (Int) | (VV = (x + y))}</span><span class='hs-varop'>+</span></a> <a class=annot href="#"><span class=annottext>(Map {VV : a | (VV &gt; k)} b) -&gt; (Int)</span><span class='hs-varid'>size</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a> <a class=annot href="#"><span class=annottext>x:(Int) -&gt; y:(Int) -&gt; {VV : (Int) | (VV = (x + y))}</span><span class='hs-varop'>+</span></a> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = (1  :  int))}</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{VV : a | (VV = k)}</span><span class='hs-varid'>k</span></a> <a class=annot href="#"><span class=annottext>{VV : a | (VV = x)}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &lt; k)} b) | (VV = l)}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>{VV : (Map {VV : a | (VV &gt; k)} b) | (VV = r)}</span><span class='hs-varid'>r</span></a>
<span class=hs-linenum>161: </span>
<span class=hs-linenum>162: </span><span class='hs-definition'>size</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>163: </span><a class=annot href="#"><span class=annottext>forall a b. (Map a b) -&gt; (Int)</span><span class='hs-definition'>size</span></a> <a class=annot href="#"><span class=annottext>(Map a b)</span><span class='hs-varid'>t</span></a> 
<span class=hs-linenum>164: </span>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <a class=annot href="#"><span class=annottext>{VV : (Map a b) | (VV = t)}</span><span class='hs-varid'>t</span></a> <span class='hs-keyword'>of</span> 
<span class=hs-linenum>165: </span>      <span class='hs-conid'>Tip</span>            <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>x:(Int#) -&gt; {VV : (Int) | (VV = (x  :  int))}</span><span class='hs-num'>0</span></a>
<span class=hs-linenum>166: </span>      <span class='hs-conid'>Bin</span> <span class='hs-varid'>sz</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>{VV : (Int) | (VV = sz)}</span><span class='hs-varid'>sz</span></a>
</pre>
